Data Science Specilization
==========================

Generated on 2016-02-07 21:01:45.

Generated by R version 3.2.3 (2015-12-10) on darwin13.4.0.

Getting and Cleaning - Final Course Project
-------------------------------------------

Initial Preperation
-------------------

Load any dependant packages and set the working directory


```r
if(!require(data.table)) {
      install.packages("data.table")
      library(data.table)
}

path <- getwd()
```

Prepare the core dataset
------------------------

Create a new folder called `data` if it doesn't already exist:


```r
if(!dir.exists('data')){
      dir.create('data')
}
datapath <- file.path(getwd(), "data")
datapath
```

```
## [1] "/Users/steve/source/Data/Cleaning_Data/Project/data"
```

Download the data set into the `data` directory if the data doesn't already exist.


```r
fileURL <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
filename <- file.path(datapath, "ActivityData.zip")
if(!file.exists(filename)){
     download.file(fileURL, filename)
}
```

Unzip the file:


```r
unzip(filename, exdir=datapath)
```

Resultant data files needed are in /Users/steve/source/Data/Cleaning_Data/Project/data/UCI HAR Dataset. Set a variable called `activitydata' to the correct path.


```r
activitdata <- file.path(datapath, "UCI HAR Dataset")
activitdata
```

```
## [1] "/Users/steve/source/Data/Cleaning_Data/Project/data/UCI HAR Dataset"
```

Load the base data
------------------


```r
dtSubjectTrainData <- fread(file.path(activitdata, "train", "subject_train.txt"))
dtActivityLabelTrainData <- fread(file.path(activitdata, "train", "Y_train.txt"))
dtTrainData <- read.table(file.path(activitdata, "train", "X_train.txt"))

dtSubjectTestData <- fread(file.path(activitdata, "test", "subject_test.txt"))
dtActivityLabelTestData <- fread(file.path(activitdata, "test", "Y_test.txt"))
dtTestData <- read.table(file.path(activitdata, "test", "X_test.txt"))
```

Performance basic sanity. Each of the Train and Test files should equal the same length.


```r
trainDataOK <- assertthat::are_equal(length(dtSubjectTestData), length(dtActivityLabelTestData), length(dtTestData))
testDataOK <- assertthat::are_equal(length(dtSubjectTrainData), length(dtActivityLabelTrainData), length(dtTrainData))

if(trainDataOK & testDataOK)
{
      'Data OK'
}else{
      'Data not OK. Exiting'
      stop()
}
```

```
## [1] "Data OK"
```

Merge the core data into a new set of tables
--------------------------------------------

Row Bind (with rbind) the Training and Test sets for both Subject and Activity.


```r
dtCoreSubject <- rbind(dtSubjectTrainData, dtSubjectTestData)
dtCoreActivity <- rbind(dtActivityLabelTrainData, dtActivityLabelTestData)
dtCore <- rbind(dtTrainData, dtTestData)
```

Clean up the table column names to something more sensible:


```r
setnames(dtCoreSubject, "V1", "subject")
setnames(dtCoreActivity, "V1", "activityid")
```

Merge all the columns together


```r
dtCoreSubject <- cbind(dtCoreSubject, dtCoreActivity)
dtCore <- cbind(dtCoreSubject, dtCore)
```

Set a key on subject and activityid for future analysis.


```r
setkey(dtCore, subject, activityid)
```

Isolate the mean/stddev columns
-------------------------------

We can use `features.txt` to find out the columns that are related to mean and stdev.

Load in the `features.txt` file, and give the data table some friendly column names


```r
dtFeatureNames <- read.table(file.path(activitdata, "features.txt"))
setnames(dtFeatureNames, names(dtFeatureNames), c("featureid", "featurename"))
head(dtFeatureNames)
```

```
##   featureid       featurename
## 1         1 tBodyAcc-mean()-X
## 2         2 tBodyAcc-mean()-Y
## 3         3 tBodyAcc-mean()-Z
## 4         4  tBodyAcc-std()-X
## 5         5  tBodyAcc-std()-Y
## 6         6  tBodyAcc-std()-Z
```

Find all mean and stddev fields (indicatd by mean or std in featurename column)
using `grepl`.


```r
dtFeatureNamesFiltered <- dtFeatureNames[grepl("mean\\(\\)|std\\(\\)", dtFeatureNames$featurename),]
head(dtFeatureNamesFiltered)
```

```
##   featureid       featurename
## 1         1 tBodyAcc-mean()-X
## 2         2 tBodyAcc-mean()-Y
## 3         3 tBodyAcc-mean()-Z
## 4         4  tBodyAcc-std()-X
## 5         5  tBodyAcc-std()-Y
## 6         6  tBodyAcc-std()-Z
```

The dtCore table has column names of V1, V2 etc. Using the index of the mean/std
columns from dtFeatureNames we can identify the columns in dtCore that we 
require for the new tidy dataset.


```r
dtFeatureNamesFiltered$featureidx <- paste0("V", dtFeatureNamesFiltered[,1])
dtCleanCore <- dtCore[, c(key(dtCore), dtFeatureNamesFiltered$featureidx), with=FALSE]
```

Clean up tidy data table
------------------------

First, we need to give our columns friendly names. These are in the `activity_labels.txt` file.

Load the file, and parse out the activity labels


```r
dtActivityLabels <- fread(file.path(activitdata, "activity_labels.txt"))
setnames(dtActivityLabels, c("activityid", "activityname"))
head(dtActivityLabels)
```

```
##    activityid       activityname
## 1:          1            WALKING
## 2:          2   WALKING_UPSTAIRS
## 3:          3 WALKING_DOWNSTAIRS
## 4:          4            SITTING
## 5:          5           STANDING
## 6:          6             LAYING
```

Let's update our dtCleanCore with the Activity Labels. Because we named the activityid column the same in both data tables, we can use the simple merge method. Set `all.x=TRUE`
in case we find a row that doesn't have a matching label.


```r
dtCleanCore <- merge(dtActivityLabels,dtCleanCore, by="activityid", all.x=TRUE)
```

Remove our activityid as we don't need it anymore


```r
dtCleanCore$activityid <- NULL
```

```
## Warning in alloc.col(x): Attempt to reduce allocation from 133 to 132
## ignored. Can only increase allocation via shallow copy.
```

```r
names(dtCleanCore)
```

```
##  [1] "activityname" "subject"      "V1"           "V2"          
##  [5] "V3"           "V4"           "V5"           "V6"          
##  [9] "V41"          "V42"          "V43"          "V44"         
## [13] "V45"          "V46"          "V81"          "V82"         
## [17] "V83"          "V84"          "V85"          "V86"         
## [21] "V121"         "V122"         "V123"         "V124"        
## [25] "V125"         "V126"         "V161"         "V162"        
## [29] "V163"         "V164"         "V165"         "V166"        
## [33] "V201"         "V202"         "V214"         "V215"        
## [37] "V227"         "V228"         "V240"         "V241"        
## [41] "V253"         "V254"         "V266"         "V267"        
## [45] "V268"         "V269"         "V270"         "V271"        
## [49] "V345"         "V346"         "V347"         "V348"        
## [53] "V349"         "V350"         "V424"         "V425"        
## [57] "V426"         "V427"         "V428"         "V429"        
## [61] "V503"         "V504"         "V516"         "V517"        
## [65] "V529"         "V530"         "V542"         "V543"
```


Rename the columns to something more useful.

Use Grep/Rename to create useful names. For example 
* ^t = Time_
* ^f = Frequency_
* Acc = Acceleration
* Mag = Magnitude
* -mean() = Mean
* -std() = StandardDeviation
* tBodyGyro = TimeBodyGyro
* tGravityAcc = TimeGravityAcceleration


```r
dtFeatureNamesFiltered[,2] <- gsub("Acc", "Acceleration", dtFeatureNamesFiltered[,2])
dtFeatureNamesFiltered[,2] <- gsub("Mag", "Magnitude", dtFeatureNamesFiltered[,2])
dtFeatureNamesFiltered[,2] <- gsub("-mean\\(\\)", "Mean", dtFeatureNamesFiltered[,2])
dtFeatureNamesFiltered[,2] <- gsub("-std\\(\\)", "StandardDiv", dtFeatureNamesFiltered[,2])
dtFeatureNamesFiltered[,2] <- gsub("^t", "Time", dtFeatureNamesFiltered[,2])
dtFeatureNamesFiltered[,2] <- gsub("^f", "Freq", dtFeatureNamesFiltered[,2])

setnames(dtCleanCore, grep("V", names(dtCleanCore), value = TRUE), as.vector(dtFeatureNamesFiltered[,2]))
names(dtCleanCore)
```

```
##  [1] "activityname"                                    
##  [2] "subject"                                         
##  [3] "TimeBodyAccelerationMean-X"                      
##  [4] "TimeBodyAccelerationMean-Y"                      
##  [5] "TimeBodyAccelerationMean-Z"                      
##  [6] "TimeBodyAccelerationStandardDiv-X"               
##  [7] "TimeBodyAccelerationStandardDiv-Y"               
##  [8] "TimeBodyAccelerationStandardDiv-Z"               
##  [9] "TimeGravityAccelerationMean-X"                   
## [10] "TimeGravityAccelerationMean-Y"                   
## [11] "TimeGravityAccelerationMean-Z"                   
## [12] "TimeGravityAccelerationStandardDiv-X"            
## [13] "TimeGravityAccelerationStandardDiv-Y"            
## [14] "TimeGravityAccelerationStandardDiv-Z"            
## [15] "TimeBodyAccelerationJerkMean-X"                  
## [16] "TimeBodyAccelerationJerkMean-Y"                  
## [17] "TimeBodyAccelerationJerkMean-Z"                  
## [18] "TimeBodyAccelerationJerkStandardDiv-X"           
## [19] "TimeBodyAccelerationJerkStandardDiv-Y"           
## [20] "TimeBodyAccelerationJerkStandardDiv-Z"           
## [21] "TimeBodyGyroMean-X"                              
## [22] "TimeBodyGyroMean-Y"                              
## [23] "TimeBodyGyroMean-Z"                              
## [24] "TimeBodyGyroStandardDiv-X"                       
## [25] "TimeBodyGyroStandardDiv-Y"                       
## [26] "TimeBodyGyroStandardDiv-Z"                       
## [27] "TimeBodyGyroJerkMean-X"                          
## [28] "TimeBodyGyroJerkMean-Y"                          
## [29] "TimeBodyGyroJerkMean-Z"                          
## [30] "TimeBodyGyroJerkStandardDiv-X"                   
## [31] "TimeBodyGyroJerkStandardDiv-Y"                   
## [32] "TimeBodyGyroJerkStandardDiv-Z"                   
## [33] "TimeBodyAccelerationMagnitudeMean"               
## [34] "TimeBodyAccelerationMagnitudeStandardDiv"        
## [35] "TimeGravityAccelerationMagnitudeMean"            
## [36] "TimeGravityAccelerationMagnitudeStandardDiv"     
## [37] "TimeBodyAccelerationJerkMagnitudeMean"           
## [38] "TimeBodyAccelerationJerkMagnitudeStandardDiv"    
## [39] "TimeBodyGyroMagnitudeMean"                       
## [40] "TimeBodyGyroMagnitudeStandardDiv"                
## [41] "TimeBodyGyroJerkMagnitudeMean"                   
## [42] "TimeBodyGyroJerkMagnitudeStandardDiv"            
## [43] "FreqBodyAccelerationMean-X"                      
## [44] "FreqBodyAccelerationMean-Y"                      
## [45] "FreqBodyAccelerationMean-Z"                      
## [46] "FreqBodyAccelerationStandardDiv-X"               
## [47] "FreqBodyAccelerationStandardDiv-Y"               
## [48] "FreqBodyAccelerationStandardDiv-Z"               
## [49] "FreqBodyAccelerationJerkMean-X"                  
## [50] "FreqBodyAccelerationJerkMean-Y"                  
## [51] "FreqBodyAccelerationJerkMean-Z"                  
## [52] "FreqBodyAccelerationJerkStandardDiv-X"           
## [53] "FreqBodyAccelerationJerkStandardDiv-Y"           
## [54] "FreqBodyAccelerationJerkStandardDiv-Z"           
## [55] "FreqBodyGyroMean-X"                              
## [56] "FreqBodyGyroMean-Y"                              
## [57] "FreqBodyGyroMean-Z"                              
## [58] "FreqBodyGyroStandardDiv-X"                       
## [59] "FreqBodyGyroStandardDiv-Y"                       
## [60] "FreqBodyGyroStandardDiv-Z"                       
## [61] "FreqBodyAccelerationMagnitudeMean"               
## [62] "FreqBodyAccelerationMagnitudeStandardDiv"        
## [63] "FreqBodyBodyAccelerationJerkMagnitudeMean"       
## [64] "FreqBodyBodyAccelerationJerkMagnitudeStandardDiv"
## [65] "FreqBodyBodyGyroMagnitudeMean"                   
## [66] "FreqBodyBodyGyroMagnitudeStandardDiv"            
## [67] "FreqBodyBodyGyroJerkMagnitudeMean"               
## [68] "FreqBodyBodyGyroJerkMagnitudeStandardDiv"
```

Create the new aggregate tidy data set
--------------------------------------

Let's aggregate our data set and clean up some of the new columns


```r
dtTidyAggregate <- aggregate(dtCleanCore, by=list(dtCleanCore$subject, dtCleanCore$activityname), FUN=mean, na.rm=TRUE)
dtTidyAggregate$Group.1 <- NULL
dtTidyAggregate$activityname <- NULL
names(dtTidyAggregate)[names(dtTidyAggregate)=="Group.2"] <- "activityname"
dtTidyAggregate <- dtTidyAggregate
```

Re-order the first two columns


```r
dtTidyAggregate <- as.data.table(cbind(subject = dtTidyAggregate$subject, activityname = dtTidyAggregate$activityname, dtTidyAggregate[,-(dtTidyAggregate$subject)]))
names(dtTidyAggregate)
```

```
##  [1] "subject"                                         
##  [2] "activityname"                                    
##  [3] "TimeBodyGyroJerkStandardDiv-Y"                   
##  [4] "TimeBodyGyroJerkStandardDiv-Z"                   
##  [5] "TimeBodyAccelerationMagnitudeMean"               
##  [6] "TimeBodyAccelerationMagnitudeStandardDiv"        
##  [7] "TimeGravityAccelerationMagnitudeMean"            
##  [8] "TimeGravityAccelerationMagnitudeStandardDiv"     
##  [9] "TimeBodyAccelerationJerkMagnitudeMean"           
## [10] "TimeBodyAccelerationJerkMagnitudeStandardDiv"    
## [11] "TimeBodyGyroMagnitudeMean"                       
## [12] "TimeBodyGyroMagnitudeStandardDiv"                
## [13] "TimeBodyGyroJerkMagnitudeMean"                   
## [14] "TimeBodyGyroJerkMagnitudeStandardDiv"            
## [15] "FreqBodyAccelerationMean-X"                      
## [16] "FreqBodyAccelerationMean-Y"                      
## [17] "FreqBodyAccelerationMean-Z"                      
## [18] "FreqBodyAccelerationStandardDiv-X"               
## [19] "FreqBodyAccelerationStandardDiv-Y"               
## [20] "FreqBodyAccelerationStandardDiv-Z"               
## [21] "FreqBodyAccelerationJerkMean-X"                  
## [22] "FreqBodyAccelerationJerkMean-Y"                  
## [23] "FreqBodyAccelerationJerkMean-Z"                  
## [24] "FreqBodyAccelerationJerkStandardDiv-X"           
## [25] "FreqBodyAccelerationJerkStandardDiv-Y"           
## [26] "FreqBodyAccelerationJerkStandardDiv-Z"           
## [27] "FreqBodyGyroMean-X"                              
## [28] "FreqBodyGyroMean-Y"                              
## [29] "FreqBodyGyroMean-Z"                              
## [30] "FreqBodyGyroStandardDiv-X"                       
## [31] "FreqBodyGyroStandardDiv-Y"                       
## [32] "FreqBodyGyroStandardDiv-Z"                       
## [33] "FreqBodyAccelerationMagnitudeMean"               
## [34] "FreqBodyAccelerationMagnitudeStandardDiv"        
## [35] "FreqBodyBodyAccelerationJerkMagnitudeMean"       
## [36] "FreqBodyBodyAccelerationJerkMagnitudeStandardDiv"
## [37] "FreqBodyBodyGyroMagnitudeMean"                   
## [38] "FreqBodyBodyGyroMagnitudeStandardDiv"            
## [39] "FreqBodyBodyGyroJerkMagnitudeMean"               
## [40] "FreqBodyBodyGyroJerkMagnitudeStandardDiv"
```

Add mean to all of the value columns to indicate that they are now all mean values for the subject and activity type:


```r
dtNewTidyVarNames <- paste0("Mean-", names(dtTidyAggregate[, !c("subject", "activityname"), with=FALSE]))
colnames(dtTidyAggregate)[c(-1,-2)] <- dtNewTidyVarNames
```

Generate the codebook


```r
knit("codebook.Rmd", quiet = TRUE, output = NULL)
```

```
## [1] "codebook.md"
```

```r
markdownToHTML("codebook.md", "codebook.html")
```
